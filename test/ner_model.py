# Import and load the spacy model
import spacy
from spacy.gold import GoldParse
from spacy.scorer import Scorer



nlp=spacy.load("en_core_web_sm")

# Getting the ner component
ner=nlp.get_pipe('ner')

# New label to add
LABEL = "Device"


TRAIN_DATA =[("The fire control system includes a laser rangefinder, computer, wind sensor and, in the latest model, thermal imaging equipment.", {"entities": [(64, 75, "Device")]}), ("Ground IR and radar sensors are used to cue the aerostat imaging sensor to identify targets.", {"entities": [(57, 71, "Device")]}), ("This sensor is compact and reliable for use in the cover gas hydrogen meter in place of the katharometer.", {"entities": [(5, 11, "Device")]}), ("In construction the katharometer comprises two chambers, each with an identical thermal conductivity sensor.", {"entities": [(80, 107, "Device")]}), ("Based on Rayleigh scattering, the sensor can be used to monitor perimeters around secure facilities and prisons.", {"entities": [(34, 40, "Device")]}), ("Most modern sensors are electronic and work on the principle that temperature, pressure or stress affects the electrical behaviour of the sensor.", {"entities": [(12, 18, "Device")]}), ("Another switch will open a system or door only when its sensor reads the eyeballs of the owner.", {"entities": [(56, 62, "Device")]}), ("It registers the severity of the crash by reading the deceleration data from the airbag's sensor.", {"entities": [(90, 96, "Device")]}), ("You've got to orient your own hand exactly or the sensor won't read it correctly.", {"entities": [(50, 56, "Device")]}), ("The hard real-time system would guarantee that sensor inputs would not be missed.", {"entities": [(47, 53, "Device")]}), ("The new rheometer provides an extended torque range, a new normal force sensor with high stability and accuracy.", {"entities": [(66, 78, "Device")]}), ("The data recorder is part of the sensor in every vehicle that triggers the air bag in a crash.", {"entities": [(33, 39, "Device")]}), ("A sensor in the heel measures changes in compression each time the wearer's foot hits the ground.", {"entities": [(2, 8, "Device")]}), ("A microprocessor, as small as a postage stamp, performs thousands of calculations per second based on readings from the sensor.", {"entities": [(120, 126, "Device")]}), ("The research team is now exploring the possibility of using eye contact sensor glasses to treat children with autistic spectrum disorder.", {"entities": [(72, 78, "Device")]}), ("Each sensor of the array undergoes a reversible change in electrical resistance when exposed to a vapor or analyte.", {"entities": [(5, 11, "Device")]}), ("Unlike the torque sensor on Miller's car, which is fitted around the pinion shaft, Kalitta's is bolted to the back of the reverser.", {"entities": [(11, 24, "Device")]}), ("The sensor preferably is either an anisotopic magnetoresistive element or a spin valve element less than 0.6 m wide.", {"entities": [(4, 10, "Device")]}), ("The new sensor allows the user to communicate with each sensor element of the array by computer.", {"entities": [(8, 14, "Device")]}), ("A second gas volume flow sensor is located in the connection line between the patient connection piece and the patient being respirated.", {"entities": [(9, 31, "Device")]}), ("Instead, a remote sensor placed outdoors transmits a radio signal to a monitor inside your house, which shows the data on a liquid crystal display.", {"entities": [(18, 24, "Device")]}), ("The laser sensor locates the positions of the leading and trailing edges of the tank, and the magnetic sensor provides confirmation of the position of the tank.", {"entities": [(4, 16, "Device")]}), ("An anemometric flow sensor, developed at the EPFL is packaged for long-term implantation in the human body for a shunt catheter for the hydrocephalus.", {"entities": [(3, 26, "Device")]}), ("With the built-in smart fingerprint sensor, the tablet's security lock can be released by simply placing the finger of a pre-registered user on the sensor.", {"entities": [(18, 42, "Device")]}), ("When your late-model car's oxygen sensor goes on the fritz, it will impair operation of the catalytic converter and probably cause your car to flunk its next emission test.", {"entities": [(27, 40, "Device")]}), ("If commandos get a new weapon or sensor, it probably will be used on a real mission or battlefield.", {"entities": [(33, 39, "Device")]}), ("Bring me your embedded RFID chips, show me your QR codes, hit me with your location-based web apps.", {"entities": [(23, 33, "Device")]}), ("Instead of scanning every item individually, an RFID till would simply total up every item in your shopping trolley as it approached.", {"entities": [(48, 52, "Device")]}), ("When a trucker whose RFID card grants him port access approaches the gate, the gate goes up, and the tire shredders stay down.", {"entities": [(21, 30, "Device")]}), ("The RFID microreaders, RFID tags and EDTP readers are not available locally.", {"entities": [(4, 21, "Device")]}), ("The RFID microreaders, RFID tags and EDTP readers are not available locally.", {"entities": [(23, 32, "Device")]}), ("Today, over a million pets and farm animals worldwide have RFID tags in or on them, so Rover or Daisy can easily be tracked if they wander off.", {"entities": [(59, 68, "Device")]}), ("The basic idea is that you carry a personalized device that jams the signals from all the RFID tags on your person until you authorize otherwise.", {"entities": [(90, 99, "Device")]}), ("These chips act as transponders, always listening for a radio signal sent by transceivers, or RFID readers.", {"entities": [(94, 106, "Device")]}), ("Clever people at the University of Rochester have flipped the typical use of RFID around and created a navigational aid for the visually impaired.", {"entities": [(77, 81, "Device")]}), ("Unlike their bar code counterparts, tags embedded with RFID chips can still operate if torn or otherwise damaged.", {"entities": [(55, 65, "Device")]}), ("The plugged-in device identifies itself as a Human Interface Device and inputs RFID tag data into any existing applications.", {"entities": [(79, 87, "Device")]}), ("Most RFID tags contain an integrated circuit for storing and processing information, modulating and demodulating a signal.", {"entities": [(5, 14, "Device")]}), ("It provides complete verification of the RFID data and overstrikes bad labels to alert users if the RFID data cannot be encoded.", {"entities": [(41, 45, "Device")]}), ("DoD Components will immediately resource and implement the use of high data capacity active RFID in the DoD operational environment.", {"entities": [(92, 96, "Device")]}), ("In the same year, the Telepass active transponder RFID system was introduced across Italy.", {"entities": [(50, 61, "Device")]}), ("The Amtech RFID technology used on the Dallas North Tollway was originally developed at Sandia Labs for use in tagging and tracking livestock.", {"entities": [(11, 15, "Device")]}), ("Virginia may become the first state to glue RFID tags into all its driver's licenses.", {"entities": [(44, 53, "Device")]}), ("The passport's critical information is stored on a tiny RFID computer chip, much like information stored on smartcards.", {"entities": [(56, 74, "Device")]}), ("Any RFID interrogator within 30 meters can read an RFID tag in active mode.", {"entities": [(4, 21, "Device")]}), ("When goods are received at the Future Store, employees transport the pallets from the truck through an RFID gate at the backstore entrance.", {"entities": [(103, 112, "Device")]}), ("This patent covers systems and methods for using RFID tags in biopharmaceutical environments where gamma radiation is used for sterilization.", {"entities": [(49, 58, "Device")]}), ("Utilizing equipment from numerous RFID suppliers in Europe and North America, Checkpoint served as a hardware integrator for the trials.", {"entities": [(34, 38, "Device")]}), ("The technical skills, industry experience, and clients of SJS will position us as a dominant player in the RFID implementation space today.", {"entities": [(107, 111, "Device")]}), ("Recently, BSF has started taking RFID to a new level internally and is in the process of automating its receiving and shipping processes.", {"entities": [(33, 37, "Device")]}), ("Stratum Global along with Intermec and other industry leaders have helped create an RFID program at Oakton Community College.", {"entities": [(84, 88, "Device")]}), ("Truth is, some universities are already using RFID technology, although use is limited.", {"entities": [(46, 50, "Device")]}), ("Paar's research interests cover fast software and hardware realizations of cryptography, RFID security, physical security, and cryptanalytical hardware.", {"entities": [(89, 93, "Device")]}), ("Since RFID tags will eventually be placed on or in corrugated packaging, there are major implications for corrugated container manufacturers and their customers.", {"entities": [(6, 15, "Device")]}), ("In 2003, Michelin began testing RFID transponders embedded into its tires.", {"entities": [(32, 49, "Device")]}), ("Patents that generally relate to the lamination process for RFID cards that use an embedded chip to enable secure financial payments and access to secure locations.", {"entities": [(60, 70, "Device")]}), ("Acsis is an EPCglobal member and early adopter of RFID technologies.", {"entities": [(50, 54, "Device")]}), ("The design not only allows easy on-site maintenance but also reserves space for further expandability on Wi-Fi, MSR, IC card reader, fingerprint, and RFID module.", {"entities": [(150, 154, "Device")]}), ("Our study used the information entropy to measure the uncertainty of the RFID data streams, and analyzed the features that could influence cleaning effect.", {"entities": [(73, 77, "Device")]}), ("Rfid uses teeny computer chips, smaller than half-a-grain of sand, to track items at a distance.", {"entities": [(0, 4, "Device")]}), ("The Ci4000 Weather-Ometer is said to continuously read specimen surface temperatures with a pyrometer and assigns a measurement to the respective specimen via an RFID tag.", {"entities": [(162, 170, "Device")]}), ("GemBox RFID has designed and developed highly reliable RFID stocktaking solutions utilizing the PJM technology, which Rubinstein Software now adopts into Fantasy.", {"entities": [(7, 11, "Device")]}), ("One of the first commercial uses of RFID was the tagging of livestock in Europe.", {"entities": [(36, 40, "Device")]}), ("Smartrac has broadened its range of RFID inlays and tags based on the high-performance Impinj Monza R6 chip.", {"entities": [(36, 56, "Device")]}), ("Data Systems International, a leader in RFID and automated data collection solutions, today announced a partnership with Axion Solutions.", {"entities": [(40, 44, "Device")]}), ("The lower floor will contain car bays, production areas, composites, machine shops, and TAG Electronics.", {"entities": [(88, 103, "Device")]}), ("Transcriptome studies of oil palm and olive have also indicated key differences in the transcriptional control of TAG biosynthesis in nonseeds from that of seed tissues.", {"entities": [(114, 130, "Device")]}), ("Very low density lipoprotein is one of the major lipoproteins transporting TAG from the liver to extrahepatic tissues, such as the adipose tissue, heart and lung.", {"entities": [(75, 78, "Device")]}), ("The MERIDIIST Automobili Lamborghini is hand-assembled and composed of more than 400 mechanical components, many derived from legendary TAG Heuer chronographs.", {"entities": [(136, 158, "Device")]}), ("Tag files provide a very simple way for content and functionality to be abstracted away from JSP pages and into reusable components.", {"entities": [(0, 3, "Device")]}), ("As the organism enters the TAG accumulation phase, transcripts representing the final biosynthesis steps for TAG and the galactoglycerolipid lipases are up-regulated.", {"entities": [(27, 30, "Device")]}), ("For 2016, Red Bull Racing used Renault engines branded as TAG Heuer.", {"entities": [(58, 67, "Device")]}), ("Products include Companion Animal Starter Kits and refills, RFID Transponders and RFID Readers.", {"entities": [(60, 77, "Device")]}), ("Products include Companion Animal Starter Kits and refills, RFID Transponders and RFID Readers.", {"entities": [(82, 94, "Device")]}), ("There's a new wee beastie come to fill your lives with joy, RFID (radio frequency identification ).", {"entities": [(60, 64, "Device")]}), ("The RFID chip in the key fob contains a select set of codes designed to work with a given car.", {"entities": [(4, 13, "Device")]}), ("Change is unlikely to be quick, because the advantages of using RFID seem minimal.", {"entities": [(64, 68, "Device")]}), ("Already there has been public outcry over an American firm tracking patients with RFID.", {"entities": [(82, 86, "Device")]}), ("The RFID tag would, rather, emit a generic recycling or waste disposal message.", {"entities": [(4, 12, "Device")]}), ("The issued blink cards have embedded chips utilizing RFID or Radio Frequency Identification Tags that transmit information to a reader once they are waved within an inch of the reader's scanner.", {"entities": [(53, 96, "Device")]}), ("Visa, MasterCard and American Express have tested the RFID cards designed to be attached to key chains, which can prevent this occurrence, unless keys are lost or forgotten.", {"entities": [(54, 64, "Device")]}), ("A gentle squeeze is all that's required to power an actuator which opens the lid without any physical effort.", {"entities": [(52, 60, "Device")]}), ("Inside the kiosk, a special camera relays images of passers-by alongside recorded shots of famous local TV and film celebrities.", {"entities": [(28, 34, "Device")]}), ("Next, point the camera at the other extreme and once again half press the release.", {"entities": [(16, 22, "Device")]}), ("Fat Man's bespectacled sidekick took the woman's video camera and rewound the tape.", {"entities": [(49, 61, "Device")]}), ("The electro-optical systems include a television camera, optional infra-red camera and laser rangefinder.", {"entities": [(38, 55, "Device")]}), ("The settings of the camera and flashes were always identical, and thus all photographs received a standard light exposure.", {"entities": [(20, 26, "Device")]}), ("The Sligo fans were definitely jubilant and dozens of camera phones captured the moment but that's as far as it went.", {"entities": [(54, 67, "Device")]}), ("An inspection report shall be issued after each inspection of a heating or airconditioning system.", {"entities": [(75, 97, "Device")]}), ("This version comes equipped with all the necessary functions for controlling and monitoring the airconditioning system.", {"entities": [(96, 118, "Device")]}), ("In small airconditioning systems such as those in cars, they can prevent smells created by bacteria in the system.", {"entities": [(9, 32, "Device")]}), ("If I am buying a house, how can I make sure that the airconditioning system is in good working order?", {"entities": [(53, 75, "Device")]}), ("The flow rate regulator is made entirely of steel, suitable for use in airconditioning and plumbing systems.", {"entities": [(71, 107, "Device")]}), ("Even now after so many decades, the concept of theatres hasn't changed except for a few improvements like airconditioning and digital stereo sound systems.", {"entities": [(106, 154, "Device")]}), ("In federal facilities, halocarbons may be present in refrigeration or deep-freeze units, airconditioning systems, heat pumps, water coolers and some types of fire extinguishers.", {"entities": [(89, 112, "Device")]}), ("The system will aim to constantly balance the energy resources supplied by the electricity network with the needs of applications and airconditioning systems.", {"entities": [(134, 157, "Device")]}), ("When a conventional airconditioning system is installed in a home, refrigerant lines run from the outdoor condensing unit to the coil in the furnace.", {"entities": [(20, 42, "Device")]}), ("Posing as tourists of the sort who visit the White House virtually every day, Army agents planted vials of mock killer chemicals where the airconditioning system carried their vapors past guards and into the Oval Office.", {"entities": [(139, 161, "Device")]}), ("Flexible connections: bendable connectors of ductwork or piping designed to prevent the transfer of vibration from heating or airconditioning equipment such as a heat pump to the main ductwork or piping in the home.", {"entities": [(126, 151, "Device")]}), ("Admit that it was the carelessness of the company's agents, in leaving the switch open, that threw the train upon the side track.", {"entities": [(75, 81, "Device")]}), ("An umbilical cable attaches to the waistcoat through my drysuit, with an external switch on the chest area.", {"entities": [(82, 88, "Device")]}), ("All that is left to do is make a bend in the wire, slightly below the tubing to make a lever for attaching a spring or switch machine.", {"entities": [(109, 133, "Device")]}), ("These suppress flare and ghosting \u00c3\u00a2 more prone to occur with digital cameras due to reflection off the image sensor.", {"entities": [(104, 116, "Device")]})]


# TEST_DATA=[("In addition, almost all come with a laser sensor, which picks up emissions from a laser gun as used in portable traps.", {"entities": [(36, 48, "Device")]}), ("The sensor could be inserted into tissue, excited with a laser pointer, and provide real-time, continuous monitoring of blood glucose level.", {"entities": [(4, 10, "Device")]}), ("The temperature of the water bath is controlled by a microprocessor and a temperature sensor.", {"entities": [(74, 92, "Device")]}), ("The sensor can time this journey down to the nanosecond, ESA says, meaning that the instrument is accurate to within two centimetres.", {"entities": [(4, 10, "Device")]}), ("In addition, a cheap sensor cannot distinguish between a water pipe, a structural beam and a power cable.", {"entities": [(21, 27, "Device")]}), ("These systems use radar as the surveillance and cueing sensor to achieve this.", {"entities": [(55, 61, "Device")]}), ("Microwave sensor data, thermal and radiometric information etc. can be got even under adverse weather conditions or cloud cover.", {"entities": [(0, 16, "Device")]}), ("The screen also has both a variable brightness control as well as an ambient light sensor that automatically adjusts to the environment.", {"entities": [(69, 89, "Device")]}), ("The oxygen sensor was inserted through the bark side in the same way as for the trees in the arboretum.", {"entities": [(4, 17, "Device")]}), ("Other options include 6-disc in-dash CD autochanger, sunroof and parking distance sensor.", {"entities": [(73, 88, "Device")]}), ("In tall canopies, the operator moves beneath the canopy along a linear path, keeping the sensor oriented to the sun with the help of a sight.", {"entities": [(89, 95, "Device")]}), ("The optical sensor functions as a rangefinder, measuring the height of the target beneath the missile and profiling the target simultaneously.", {"entities": [(12, 18, "Device")]}), ("The wireless sensor technology is used to monitor pressure within an aortic aneurysm.", {"entities": [(13, 19, "Device")]}), ("The sculpture is embedded with 3,000 toy dogs whose little synchronized yaps are triggered by a hidden motion sensor.", {"entities": [(103, 116, "Device")]}), ("Optimal sensor placement is desirable to ensure adequate coverage of the network's flow for detection and remediation of contaminants.", {"entities": [(8, 14, "Device")]}), ("The concept of the device is to activate a remote sensor that will trigger the device on the vehicle that will bring it to a stop.", {"entities": [(50, 56, "Device")]}), ("A small sensor, the accelerometer, placed nearby then detects the sound waves and analyses their acoustic signature.", {"entities": [(8, 14, "Device")]}), ("The breaker trips when the sensor determines that the amperage at the hot terminal is not equal to the amperage at the neutral terminal.", {"entities": [(27, 33, "Device")]}), ("We were communicating fairly well and I was about to renew my questions as to how he came to be here when the sensor alert sounded.", {"entities": [(110, 116, "Device")]}), ("In late 2009 Borkholder wrote a white paper proposal to DARPA that pitched a disposable blast gauge using a tiny pressure sensor.", {"entities": [(113, 128, "Device")]}), ("When said light enters your bloodstream only a portion is reflected and returned to the sensor thus giving you your readout.", {"entities": [(88, 94, "Device")]}), ("I told her several days ago I thought the yardmen damaged the backyard rain sensor when they trimmed the shrubs but God forbid we should listen to Rana.", {"entities": [(71, 82, "Device")]}), ("On many projects, said O'Mahony, the engineering team is left trying to fight science by being asked to achieve some unrealistic sensor or actuator accuracies.", {"entities": [(129, 135, "Device")]}), ("If a given tackle exceeds a certain level of force, the sensor is activated and the player is notified to seek medical attention.", {"entities": [(56, 62, "Device")]}),("If that actuator starts to move unexpectedly, it acts as a generator and the short provides an electrical load that slows the motor down.", {"entities": [(8, 16, "Device")]}), ("The actuator valve assembly and suction tube is screwed onto the cylinder and the tank is pressurized with a standard tire inflation system.", {"entities": [(4, 12, "Device")]}), ("The actuator is then de-energized and the switching contacts return to their starting positions.", {"entities": [(4, 12, "Device")]}), ("Each unit consisted of a quadrant and bellcrank assembly, a control valve, an actuator cylinder assembly and a bypass control assembly.", {"entities": [(78, 104, "Device")]}), ("An attachable implement such as a loader bucket is attached to the actuator.", {"entities": [(67, 75, "Device")]}), ("The Army conducted extensive testing of the trailer, with a modified brake actuator mechanism and strengthened trailer chassis and tow bar.", {"entities": [(69, 83, "Device")]}), ("The ball valve can be operated automatically through an actuator or manually with the handle.", {"entities": [(56, 64, "Device")]}), ("The actuator body pivots about a pivot axis and is attached to the cartridge bearing assembly disposed within an inner hollow of the actuator body.", {"entities": [(4, 12, "Device")]}), ("On many projects, said O'Mahony, the engineering team is left trying to fight science by being asked to achieve some unrealistic sensor or actuator accuracies.", {"entities": [(139, 147, "Device")]}), ("The voice coil actuator is not only far more adaptable and insensitive to thermal issues.", {"entities": [(4, 23, "Device")]}), ("There was no indication of any structural damage that would degrade the stiffness of the actuator attachment.", {"entities": [(89, 108, "Device")]}), ("Readjust end position OPEN according to the operation instructions of the actuator.", {"entities": [(74, 82, "Device")]}), ("The adjusting lever or actuator is fitted on the same side as the gear wheel.", {"entities": [(23, 31, "Device")]}), ("A stop valve having a thermal or motorised actuator, which varies the amount of flow as a function of ambient temperature, is suitable for this.", {"entities": [(22, 51, "Device")]}), ("The actuator also includes an electrode fabricated on the supporting substrate.", {"entities": [(4, 12, "Device")]}), ("Each of the four servos includes a hydraulic actuator and a hydraulic distributor.", {"entities": [(35, 53, "Device")]}), ("The systematic variation in the actuator parameters made it possible to enhance their performance considerably.", {"entities": [(32, 40, "Device")]}), ("The air pressure on each side of the actuator piston determines the setting of the transmission.", {"entities": [(37, 52, "Device")]}), ("The distance shall be decreased by 15 cm in the case of no ignition at 60 cm distance between burner flame and aerosol actuator.", {"entities": [(111, 127, "Device")]}), ("A piston rod of the hydraulic actuator imparts movement to a generally vertically oriented articulated linkage member.", {"entities": [(20, 38, "Device")]}), ("He struggled with his vulcanized suit, trying to squeeze from under the actuator.", {"entities": [(72, 80, "Device")]}), ("Obviously, the actuator had smashed his transmitter, but left the receiver section intact.", {"entities": [(15, 23, "Device")]}), ("The tape moved on unperturbedly, reminding him to inspect the actuator bearings and extension rods.", {"entities": [(62, 70, "Device")]})]

TEST_DATA=[("In addition, almost all come with a laser sensor, which picks up emissions from a laser gun as used in portable traps.", [(36, 48, "Device")]), ("The sensor could be inserted into tissue, excited with a laser pointer, and provide real-time, continuous monitoring of blood glucose level.", [(4, 10, "Device")]), ("The temperature of the water bath is controlled by a microprocessor and a temperature sensor.", [(74, 92, "Device")]), ("The sensor can time this journey down to the nanosecond, ESA says, meaning that the instrument is accurate to within two centimetres.", [(4, 10, "Device")]), ("In addition, a cheap sensor cannot distinguish between a water pipe, a structural beam and a power cable.", [(21, 27, "Device")]), ("These systems use radar as the surveillance and cueing sensor to achieve this.", [(55, 61, "Device")]), ("Microwave sensor data, thermal and radiometric information etc. can be got even under adverse weather conditions or cloud cover.", [(0, 16, "Device")]), ("The screen also has both a variable brightness control as well as an ambient light sensor that automatically adjusts to the environment.", [(69, 89, "Device")]), ("The oxygen sensor was inserted through the bark side in the same way as for the trees in the arboretum.", [(4, 17, "Device")]), ("Other options include 6-disc in-dash CD autochanger, sunroof and parking distance sensor.", [(73, 88, "Device")]), ("In tall canopies, the operator moves beneath the canopy along a linear path, keeping the sensor oriented to the sun with the help of a sight.", [(89, 95, "Device")]), ("The optical sensor functions as a rangefinder, measuring the height of the target beneath the missile and profiling the target simultaneously.", [(12, 18, "Device")]), ("The wireless sensor technology is used to monitor pressure within an aortic aneurysm.", [(13, 19, "Device")]), ("The sculpture is embedded with 3,000 toy dogs whose little synchronized yaps are triggered by a hidden motion sensor.", [(103, 116, "Device")]), ("Optimal sensor placement is desirable to ensure adequate coverage of the network's flow for detection and remediation of contaminants.", [(8, 14, "Device")]), ("The concept of the device is to activate a remote sensor that will trigger the device on the vehicle that will bring it to a stop.", [(50, 56, "Device")]), ("A small sensor, the accelerometer, placed nearby then detects the sound waves and analyses their acoustic signature.", [(8, 14, "Device")]), ("The breaker trips when the sensor determines that the amperage at the hot terminal is not equal to the amperage at the neutral terminal.", [(27, 33, "Device")]), ("We were communicating fairly well and I was about to renew my questions as to how he came to be here when the sensor alert sounded.", [(110, 116, "Device")]), ("In late 2009 Borkholder wrote a white paper proposal to DARPA that pitched a disposable blast gauge using a tiny pressure sensor.", [(113, 128, "Device")]), ("When said light enters your bloodstream only a portion is reflected and returned to the sensor thus giving you your readout.", [(88, 94, "Device")]), ("I told her several days ago I thought the yardmen damaged the backyard rain sensor when they trimmed the shrubs but God forbid we should listen to Rana.", [(71, 82, "Device")]), ("On many projects, said O'Mahony, the engineering team is left trying to fight science by being asked to achieve some unrealistic sensor or actuator accuracies.", [(129, 135, "Device")]), ("If a given tackle exceeds a certain level of force, the sensor is activated and the player is notified to seek medical attention.", [(56, 62, "Device")]),("If that actuator starts to move unexpectedly, it acts as a generator and the short provides an electrical load that slows the motor down.", [(8, 16, "Device")]), ("The actuator valve assembly and suction tube is screwed onto the cylinder and the tank is pressurized with a standard tire inflation system.", [(4, 12, "Device")]), ("The actuator is then de-energized and the switching contacts return to their starting positions.", [(4, 12, "Device")]), ("Each unit consisted of a quadrant and bellcrank assembly, a control valve, an actuator cylinder assembly and a bypass control assembly.", [(78, 104, "Device")]), ("An attachable implement such as a loader bucket is attached to the actuator.", [(67, 75, "Device")]), ("The Army conducted extensive testing of the trailer, with a modified brake actuator mechanism and strengthened trailer chassis and tow bar.", [(69, 83, "Device")]), ("The ball valve can be operated automatically through an actuator or manually with the handle.", [(56, 64, "Device")]), ("The actuator body pivots about a pivot axis and is attached to the cartridge bearing assembly disposed within an inner hollow of the actuator body.", [(4, 12, "Device")]), ("On many projects, said O'Mahony, the engineering team is left trying to fight science by being asked to achieve some unrealistic sensor or actuator accuracies.", [(139, 147, "Device")]), ("The voice coil actuator is not only far more adaptable and insensitive to thermal issues.", [(4, 23, "Device")]), ("There was no indication of any structural damage that would degrade the stiffness of the actuator attachment.", [(89, 108, "Device")]), ("Readjust end position OPEN according to the operation instructions of the actuator.", [(74, 82, "Device")]), ("The adjusting lever or actuator is fitted on the same side as the gear wheel.", [(23, 31, "Device")]), ("A stop valve having a thermal or motorised actuator, which varies the amount of flow as a function of ambient temperature, is suitable for this.", [(22, 51, "Device")]), ("The actuator also includes an electrode fabricated on the supporting substrate.", [(4, 12, "Device")]), ("Each of the four servos includes a hydraulic actuator and a hydraulic distributor.", [(35, 53, "Device")]), ("The systematic variation in the actuator parameters made it possible to enhance their performance considerably.", [(32, 40, "Device")]), ("The air pressure on each side of the actuator piston determines the setting of the transmission.", [(37, 52, "Device")]), ("The distance shall be decreased by 15 cm in the case of no ignition at 60 cm distance between burner flame and aerosol actuator.", [(111, 127, "Device")]), ("A piston rod of the hydraulic actuator imparts movement to a generally vertically oriented articulated linkage member.", [(20, 38, "Device")]), ("He struggled with his vulcanized suit, trying to squeeze from under the actuator.", [(72, 80, "Device")]), ("Obviously, the actuator had smashed his transmitter, but left the receiver section intact.", [(15, 23, "Device")]), ("The tape moved on unperturbedly, reminding him to inspect the actuator bearings and extension rods.", [(62, 70, "Device")])]


text_test="""TEST_DATA=[("In addition, almost all come with a laser sensor, which picks up emissions from a laser gun as used in portable traps.", {"entities": [(36, 48, "Device")]}), ("The sensor could be inserted into tissue, excited with a laser pointer, and provide real-time, continuous monitoring of blood glucose level.", {"entities": [(4, 10, "Device")]}), ("The temperature of the water bath is controlled by a microprocessor and a temperature sensor.", {"entities": [(74, 92, "Device")]}), ("The sensor can time this journey down to the nanosecond, ESA says, meaning that the instrument is accurate to within two centimetres.", {"entities": [(4, 10, "Device")]}), ("In addition, a cheap sensor cannot distinguish between a water pipe, a structural beam and a power cable.", {"entities": [(21, 27, "Device")]}), ("These systems use radar as the surveillance and cueing sensor to achieve this.", {"entities": [(55, 61, "Device")]}), ("Microwave sensor data, thermal and radiometric information etc. can be got even under adverse weather conditions or cloud cover.", {"entities": [(0, 16, "Device")]}), ("The screen also has both a variable brightness control as well as an ambient light sensor that automatically adjusts to the environment.", {"entities": [(69, 89, "Device")]}), ("The oxygen sensor was inserted through the bark side in the same way as for the trees in the arboretum.", {"entities": [(4, 17, "Device")]}), ("Other options include 6-disc in-dash CD autochanger, sunroof and parking distance sensor.", {"entities": [(73, 88, "Device")]}), ("In tall canopies, the operator moves beneath the canopy along a linear path, keeping the sensor oriented to the sun with the help of a sight.", {"entities": [(89, 95, "Device")]}), ("The optical sensor functions as a rangefinder, measuring the height of the target beneath the missile and profiling the target simultaneously.", {"entities": [(12, 18, "Device")]}), ("The wireless sensor technology is used to monitor pressure within an aortic aneurysm.", {"entities": [(13, 19, "Device")]}), ("The sculpture is embedded with 3,000 toy dogs whose little synchronized yaps are triggered by a hidden motion sensor.", {"entities": [(103, 116, "Device")]}), ("Optimal sensor placement is desirable to ensure adequate coverage of the network's flow for detection and remediation of contaminants.", {"entities": [(8, 14, "Device")]}), ("The concept of the device is to activate a remote sensor that will trigger the device on the vehicle that will bring it to a stop.", {"entities": [(50, 56, "Device")]}), ("A small sensor, the accelerometer, placed nearby then detects the sound waves and analyses their acoustic signature.", {"entities": [(8, 14, "Device")]}), ("The breaker trips when the sensor determines that the amperage at the hot terminal is not equal to the amperage at the neutral terminal.", {"entities": [(27, 33, "Device")]}), ("We were communicating fairly well and I was about to renew my questions as to how he came to be here when the sensor alert sounded.", {"entities": [(110, 116, "Device")]}), ("In late 2009 Borkholder wrote a white paper proposal to DARPA that pitched a disposable blast gauge using a tiny pressure sensor.", {"entities": [(113, 128, "Device")]}), ("When said light enters your bloodstream only a portion is reflected and returned to the sensor thus giving you your readout.", {"entities": [(88, 94, "Device")]}), ("I told her several days ago I thought the yardmen damaged the backyard rain sensor when they trimmed the shrubs but God forbid we should listen to Rana.", {"entities": [(71, 82, "Device")]}), ("On many projects, said O'Mahony, the engineering team is left trying to fight science by being asked to achieve some unrealistic sensor or actuator accuracies.", {"entities": [(129, 135, "Device")]}), ("If a given tackle exceeds a certain level of force, the sensor is activated and the player is notified to seek medical attention.", {"entities": [(56, 62, "Device")]}),("If that actuator starts to move unexpectedly, it acts as a generator and the short provides an electrical load that slows the motor down.", {"entities": [(8, 16, "Device")]}), ("The actuator valve assembly and suction tube is screwed onto the cylinder and the tank is pressurized with a standard tire inflation system.", {"entities": [(4, 12, "Device")]}), ("The actuator is then de-energized and the switching contacts return to their starting positions.", {"entities": [(4, 12, "Device")]}), ("Each unit consisted of a quadrant and bellcrank assembly, a control valve, an actuator cylinder assembly and a bypass control assembly.", {"entities": [(78, 104, "Device")]}), ("An attachable implement such as a loader bucket is attached to the actuator.", {"entities": [(67, 75, "Device")]}), ("The Army conducted extensive testing of the trailer, with a modified brake actuator mechanism and strengthened trailer chassis and tow bar.", {"entities": [(69, 83, "Device")]}), ("The ball valve can be operated automatically through an actuator or manually with the handle.", {"entities": [(56, 64, "Device")]}), ("The actuator body pivots about a pivot axis and is attached to the cartridge bearing assembly disposed within an inner hollow of the actuator body.", {"entities": [(4, 12, "Device")]}), ("On many projects, said O'Mahony, the engineering team is left trying to fight science by being asked to achieve some unrealistic sensor or actuator accuracies.", {"entities": [(139, 147, "Device")]}), ("The voice coil actuator is not only far more adaptable and insensitive to thermal issues.", {"entities": [(4, 23, "Device")]}), ("There was no indication of any structural damage that would degrade the stiffness of the actuator attachment.", {"entities": [(89, 108, "Device")]}), ("Readjust end position OPEN according to the operation instructions of the actuator.", {"entities": [(74, 82, "Device")]}), ("The adjusting lever or actuator is fitted on the same side as the gear wheel.", {"entities": [(23, 31, "Device")]}), ("A stop valve having a thermal or motorised actuator, which varies the amount of flow as a function of ambient temperature, is suitable for this.", {"entities": [(22, 51, "Device")]}), ("The actuator also includes an electrode fabricated on the supporting substrate.", {"entities": [(4, 12, "Device")]}), ("Each of the four servos includes a hydraulic actuator and a hydraulic distributor.", {"entities": [(35, 53, "Device")]}), ("The systematic variation in the actuator parameters made it possible to enhance their performance considerably.", {"entities": [(32, 40, "Device")]}), ("The air pressure on each side of the actuator piston determines the setting of the transmission.", {"entities": [(37, 52, "Device")]}), ("The distance shall be decreased by 15 cm in the case of no ignition at 60 cm distance between burner flame and aerosol actuator.", {"entities": [(111, 127, "Device")]}), ("A piston rod of the hydraulic actuator imparts movement to a generally vertically oriented articulated linkage member.", {"entities": [(20, 38, "Device")]}), ("He struggled with his vulcanized suit, trying to squeeze from under the actuator.", {"entities": [(72, 80, "Device")]}), ("Obviously, the actuator had smashed his transmitter, but left the receiver section intact.", {"entities": [(15, 23, "Device")]}), ("The tape moved on unperturbedly, reminding him to inspect the actuator bearings and extension rods.", {"entities": [(62, 70, "Device")]})]
"""

# Add the new label to ner
ner.add_label(LABEL)

# Resume training
optimizer = nlp.resume_training()
move_names = list(ner.move_names)

# List of pipes you want to train
pipe_exceptions = ["ner", "trf_wordpiecer", "trf_tok2vec"]

# List of pipes which should remain unaffected in training
other_pipes = [pipe for pipe in nlp.pipe_names if pipe not in pipe_exceptions]


# Importing requirements
from spacy.util import minibatch, compounding
import random

losses2plot=[]
e2plot=[]
losses = {}

from datetime import datetime

now = datetime.now()

current_time = now.strftime("%H:%M:%S")
print("Current Time =", current_time)

# Begin training by disabling other pipeline components
with nlp.disable_pipes(*other_pipes) :

  sizes = compounding(1.0, 100.0, 1.001)
  # Training for 30 iterations
  for itn in range(1000):
    # shuffle examples before training
    # print("interation",itn)
    # print("Losses",losses)

    # print("Losses",losses)

    random.shuffle(TRAIN_DATA)
    # batch up the examples using spaCy's minibatch
    batches = minibatch(TRAIN_DATA, size=sizes)
    # ictionary to store losses
    losses = {}
    for batch in batches:
      texts, annotations = zip(*batch)
      # Calling update() over the iteration
      nlp.update(texts, annotations, sgd=optimizer, drop=0.35, losses=losses)
      #print("Losses", losses)
    print('epoch',itn,losses["ner"])
    losses2plot.append(losses["ner"])
    e2plot.append(itn)

def evaluate(ner_model, examples):
    scorer = Scorer()
    for input_, annot in examples:
        doc_gold_text = ner_model.make_doc(input_)
        gold = GoldParse(doc_gold_text, entities=annot)
        pred_value = ner_model(input_)
        scorer.score(pred_value, gold)
    return scorer.scores


doc = nlp(text_test)
print("\n\n\Test data\n\n")
for ent in doc.ents:
  print(ent.text,ent.label_)

print("n\n\ Precision (p), Recall(r) and F-score(f) \n\n")
# import pdb; pdb.set_trace()
results = evaluate(nlp, TEST_DATA)
print(results['ents_per_type'])

import matplotlib.pyplot as plt

# plt.plot(e2plot, losses2plot)
# plt.xlabel("Epochs")
# plt.ylabel("Loss")
# plt.show()
# now = datetime.now()

current_time = now.strftime("%H:%M:%S")
print("Current Time =", current_time)
# {'Device': {'p': 76.19047619047619, 'r': 34.04255319148936, 'f': 47.05882352941176}}





#
# ("In addition, almost all come with a laser sensor, which picks up emissions from a laser gun as used in portable traps.", [(36, 48, "Device")]),
# ("The sensor could be inserted into tissue, excited with a laser pointer, and provide real-time, continuous monitoring of blood glucose level.", [(4, 10, "Device")]),
# ("The temperature of the water bath is controlled by a microprocessor and a temperature sensor.", [(74, 92, "Device")])
